@model IEnumerable<dynamic>

@{
    ViewData["Title"] = "Aprobacion de auditoria mensual - Incoming";
}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"]</title>
    <link rel="stylesheet" href="~/css/supervisor.css">
</head>
<body>
    <header>
        <a href="@Url.Action("Login", "Account")" class="back-button">
            <img src="~/images/previous.png" alt="Regresar" />
        </a>
        <h1>@ViewData["Title"]</h1>
    </header>
    <table class="audit-table">
        <thead>
            <tr>
                <th>Fecha de Auditoría</th>
                <th>Estado de Aprobación Incoming</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var group in Model)
            {
                // Verificamos si el estado es "Aprobado" o "Pendiente"
                var isApprovedIncoming = group.Estado == "Aprobado";

                <tr>
                    <!-- Mostramos la fecha en formato MM-dd-yyyy -->
                    <td>@DateTime.Parse(group.AuditDate.ToString()).ToString("MM-dd-yyyy")</td>

                    <td>
                        @if (isApprovedIncoming)
                        {
                            <span class="approved-incoming">Aprobado</span>
                        }
                        else
                        {
                            <span class="not-approved">Pendiente</span>
                        }
                    </td>
                    <td>
                        <!-- Botón para ver detalles -->
                        <a href="@Url.Action("Details", "Details", new { date = DateTime.Parse(group.AuditDate.ToString()).ToString("yyyy-MM-dd") })" class="details-btn">Ver Detalles</a>

                        <!-- Botón de aprobar si no está aprobado -->
                        @if (!isApprovedIncoming)
                        {
                            <!-- Mandamos la fecha en formato yyyy-MM-dd al backend -->
                            <button class="approve-btn" data-date="@DateTime.Parse(group.AuditDate.ToString()).ToString("yyyy-MM-dd")" data-role="Incoming">Aprobar</button>
                        }
                        else
                        {
                            <button class="approve-btn" disabled>Aprobado</button>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>

    <!-- Importar Axios desde CDN -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="~/js/supervisor.js"></script>
</body>
</html>
